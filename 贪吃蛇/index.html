<!DOCTYPE html>
<html>
<head>
    <title>网页版贪吃蛇</title>
    <style>
        canvas {
            border: 2px solid #000;
        }
        body {
            display: flex;
            justify-content: center;
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="420" height="420"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gridSize = 10;
        const gameSize = 420;
        const offset = gameSize / 2;

        let snake = [
            [0, 0], [10, 0], [20, 0], 
            [30, 0], [40, 0], [50, 0]
        ];
        let apple = {
            x: Math.floor(Math.random() * 38 - 19) * 10,
            y: Math.floor(Math.random() * 38 - 19) * 10
        };
        let direction = [0, 10];
        let gameSpeed = 200;
        let gameLoop;

        // 坐标转换函数（将中心坐标系转换为canvas坐标系）
        function transformCoord(x, y) {
            return [x + offset, -y + offset];
        }

        function drawSquare(x, y, color) {
            const [tx, ty] = transformCoord(x, y);
            ctx.fillStyle = color;
            ctx.fillRect(tx, ty, gridSize, gridSize);
        }

        function checkCollision() {
            // 边界检测
            if (Math.abs(snake[snake.length-1][0]) > 190 || 
                Math.abs(snake[snake.length-1][1]) > 190) {
                return true;
            }
            
            // 自碰检测
            for (let i = 0; i < snake.length - 1; i++) {
                if (snake[i][0] === snake[snake.length-1][0] && 
                    snake[i][1] === snake[snake.length-1][1]) {
                    return true;
                }
            }
            return false;
        }

        function updateGame() {
            // 移动蛇
            const head = [
                snake[snake.length-1][0] + direction[0],
                snake[snake.length-1][1] + direction[1]
            ];
            snake.push(head);

            // 吃苹果检测
            if (head[0] === apple.x && head[1] === apple.y) {
                apple = {
                    x: Math.floor(Math.random() * 38 - 19) * 10,
                    y: Math.floor(Math.random() * 38 - 19) * 10
                };
            } else {
                snake.shift();
            }

            // 碰撞检测
            if (checkCollision()) {
                clearInterval(gameLoop);
                ctx.fillStyle = 'red';
                drawSquare(head[0], head[1], 'red');
                setTimeout(initGame, 2000);
            }

            // 重绘画布
            ctx.clearRect(0, 0, gameSize, gameSize);
            
            // 绘制游戏区
            ctx.fillStyle = 'white';
            ctx.fillRect(offset - 200, offset - 195, 390, 390);
            
            // 绘制苹果
            drawSquare(apple.x, apple.y, 'red');
            
            // 绘制蛇
            snake.forEach(segment => {
                drawSquare(segment[0], segment[1], 'black');
            });
        }

        function initGame() {
            snake = [
                [0, 0], [10, 0], [20, 0],
                [30, 0], [40, 0], [50, 0]
            ];
            direction = [0, 10];
            apple = {
                x: Math.floor(Math.random() * 38 - 19) * 10,
                y: Math.floor(Math.random() * 38 - 19) * 10
            };
            if (gameLoop) clearInterval(gameLoop);
            gameLoop = setInterval(updateGame, gameSpeed);
        }

        // 事件监听
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'w': direction = [0, 10]; break;
                case 's': direction = [0, -10]; break;
                case 'a': direction = [-10, 0]; break;
                case 'd': direction = [10, 0]; break;
            }
        });

        // 初始化游戏
        initGame();
    </script>
</body>
</html>